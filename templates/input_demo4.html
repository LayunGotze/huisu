<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <meta charset="utf-8">
    <link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* css 代码  */
    </style>
    <script src="https://img.hcharts.cn/jquery/jquery-1.8.3.min.js"></script>
    <script src="https://img.hcharts.cn/highcharts/highcharts.js"></script>
    <script src="https://img.hcharts.cn/highcharts/modules/exporting.js"></script>
    <script src="https://img.hcharts.cn/highcharts/modules/oldie.js"></script>
    <script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
    {% load staticfiles %}
    <script src="{% static 'js/hot_chart.js' %}"></script>
    <script src="{% static 'js/hot_chart2.js' %}"></script>
    <script type="text/javascript" src="{%static "js/echarts.js" %}"></script>
</head>

<body>
    <div id="test">
        <span>施事者姓名:</span><input type="text" name="actor1_1" id="actor1_1" />
        <span>受事者姓名:</span><input type="text" name="actor1_2" id="actor1_2" />
        <span>事件:</span>
        <span>事件</span>
        <select id="code">
            <option value="口头合作">口头合作</option>
            <option value="实际合作">实际合作</option>
            <option value="合作">合作</option>
            <option value="口头冲突">口头冲突</option>
            <option value="实际冲突">实际冲突</option>
            <option value="冲突">冲突</option>
            <option value="全部">全部</option>
        </select>
        <span>开始时间</span><input type="date" name="start" id="start" />
        <span>截止时间</span><input type="date" name="end" id="end" />
        <input type="button" onclick="click3()" value="Submit" />
        <button onclick="click2()"><span>添加</span></button>
    </div>
    <div class="col-md-10">
        <h3 class="headline first-child"><span class="fa fa-area-chart"></span></h3>
        <div class="col-md-12">
            <h1 id="quad1">公开声明时间线</h1>
        </div>
        <div class="col-md-12">
            <div id="quadclass_1" style="width: 100%;height: 600px"></div>
        </div>
    </div>
    <div class="col-md-10">
        <h3 class="headline first-child"><span class="fa fa-area-chart"></span></h3>
        <div class="col-md-12">
            <h1 id="quad2"></h1>
        </div>
        <div class="col-md-12">
            <div id="quadclass_2" style="width: 100%;height: 600px"></div>
        </div>
    </div>
    <div class="col-md-10">
        <h3 class="headline first-child"><span class="fa fa-area-chart"></span></h3>
        <div class="col-md-12">
            <h1 id="quad3"></h1>
        </div>
        <div class="col-md-12">
            <div id="quadclass_3" style="width: 100%;height: 600px"></div>
        </div>
    </div>
    <div class="col-md-10">
        <h3 class="headline first-child"><span class="fa fa-area-chart"></span></h3>
        <div class="col-md-12">
            <h1 id="quad4"></h1>
        </div>
        <div class="col-md-12">
            <div id="quadclass_4" style="width: 100%;height: 600px"></div>
        </div>
    </div>
    <div class="col-md-10">
        <h3 class="headline first-child"><span class="fa fa-area-chart"></span></h3>
        <div class="col-md-12">
            <h1 id="quad5"></h1>
        </div>
        <div class="col-md-12">
            <div id="quadclass_5" style="width: 100%;height: 600px"></div>
        </div>
    </div>
    <div class="col-md-10">
        <h3 class="headline first-child"><span class="fa fa-area-chart"></span></h3>
        <div class="col-md-12">
            <h1>根类数据时间线</h1>
            <p>根类数据时间线以时间为单位，展示与时间对应的的根类数据，包括(口头合作)Verbal Cooperation，(物质合作)Material Cooperation，(口头冲突)Verbal
                Conflict，(物质冲突)Material Conflict 4种数据，形成时间-根类数据变化曲线图。</p>
        </div>
        <div class="col-md-12">
            <div id="quadclass_graph" style="width: 100%;height: 600px"></div>
        </div>
    </div>
</body>

</html>

<script>
    var cnt = 1;
    function click2() {
        cnt++;
        $('#test').append('<div><span>施事者姓名1:</span><input type="text" name="actor' + cnt + '_1" id="actor' + cnt + '_1" /><span>受事者姓名2:</span><input type="text" name="actor' + cnt + '_2" id="actor' + cnt + '_2" /></div>');
    }
    function click3() {
        var actor1_list = [], actor2_list = [];
        for (var i = 1; i <= cnt; i++) {
            actor1_list.push($('#actor' + i + '_1').val());
            actor2_list.push($('#actor' + i + '_2').val());
        }
        event = $('#code option:selected ').val();
        startdate = $('#start').val();
        enddate = $('#end').val();
        startdate = date_split(startdate);
        enddate = date_split(enddate);
        console.log(actor1_list);
        console.log(actor2_list);
        console.log(event);
        console.log(startdate);
        console.log(enddate);
        $.get('/api/event4/', { 'actor1': actor1_list, 'actor2': actor2_list, 'event': event, 'start': startdate, 'end': enddate }, function (data) {
            console.log(data);
            draw_hot_charts('quadclass_graph', '数据时间线', data)
            //draw_chart(data);
        })
    }
    var data_all={1: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [2, 34, 38, 51, 21, 12, 0, 0, 0, 1]}]}, 
    2: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 1, 3, 10, 5, 12, 0, 0, 0, 0]}]}, 
    3: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [5, 27, 30, 23, 20, 25, 0, 0, 0, 0]}]}, 
    4: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [19, 19, 24, 17, 15, 16, 0, 0, 1, 0]}]}, 
    5: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [1, 3, 2, 8, 7, 3, 0, 0, 0, 0]}]}, 
    6: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [1, 4, 13, 16, 18, 6, 0, 0, 0, 0]}]}, 
    7: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 0, 1, 3, 3, 1, 0, 0, 0, 0]}]}, 
    8: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [4, 2, 7, 5, 1, 0, 0, 0, 0, 0]}]}, 
    9: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 4, 2, 6, 0, 1, 0, 0, 0, 4]}]}, 
    10: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 1, 0, 1, 1, 5, 0, 0, 0, 0]}]}, 
    11: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [2, 3, 9, 5, 9, 3, 0, 1, 0, 0]}]},
    12: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [1, 1, 4, 4, 0, 0, 0, 0, 0, 0]}]},
    13: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 0, 2, 0, 3, 3, 0, 0, 0, 0]}]}, 
    14: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 0, 3, 1, 0, 0, 0, 0, 0, 0]}]}, 
    15: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 0, 1, 0, 0, 0, 0, 0, 0, 0]}]}, 
    16: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}]}, 
    17: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [2, 4, 13, 15, 15, 31, 0, 0, 0, 0]}]}, 
    18: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 1, 0, 0, 0, 1, 0, 0, 0, 0]}]}, 
    19: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [2, 1, 7, 5, 6, 1, 0, 0, 0, 0]}]},
    20: {'time': ['20180401', '20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['事件热度'], 'data': [{'name': ['事件热度'], 'type': 'line', 'smooth': 'true', 'data': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}]}}
    var data = {'time': ['20180402', '20180403', '20180404', '20180405', '20180406', '20180407', '20180408', '20180409', '20180410'], 'legend': ['口头合作', '实际合作', '口头冲突', '实际冲突'], 'data': [{'name': '口头合作', 'type': 'line', 'smooth': 'true', 'data': [27, 84, 97, 109, 68, 68, 0, 0, 1]}, {'name': '实际合作', 'type': 'line', 'smooth': 'true', 'data': [5, 11, 23, 31, 23, 13, 0, 0, 0]}, {'name': '口头冲突', 'type': 'line', 'smooth': 'true', 'data': [3, 4, 19, 10, 12, 6, 0, 1, 0]}, {'name': '实际冲突', 'type': 'line', 'smooth': 'true', 'data': [4, 6, 20, 20, 21, 33, 0, 0, 0]}]};

    var event_code_map_reverse={1: '官方声明', 2: '上诉', 3: '表达合作意向', 4: '咨询',
                5: '从事外交合作', 6: '开展物质合作', 7: '提供援助', 8: '投降', 9: '研究',
                10: '需求', 11: '反对', 12: '拒绝', 13: '威胁', 14: '抗议', 15: '展示力量部署',
                16: '减少联系', 17: '强迫', 18: '突击', 19: '战斗',20:'非常规大规模暴力'}
    draw_hot_charts('quadclass_graph', '数据时间线', data);
    for(var i=1;i<=20;i++)
    {
        //$('#quad'+i).text(event_code_map_reverse[i]+'时间线');
        data_all[i]['legend'][0]=event_code_map_reverse[i]+'时间线';
        draw_hot_charts('quadclass_'+i, '数据时间线', data_all[i]);
    }
    function split2list(text) {   //将字符串中的,分隔开，得到list
        //缺少类型的转换 eventcode
        list = text.split(',');
        return list;
    }
    function date_split(date) {
        //将DATE转换为8位字符串形式
        date_list = date.split('-');
        res = "";
        if (date_list.length == 3)
            res = date_list[0] + date_list[1] + date_list[2];
        return res;
    }
    function list2int(list) {
        //将EVENT中的字符串转换为INT
        res = [];
        l = list.length;
        for (var i = 0; i < l; i++) {
            res.push(parseInt(list[i]));
        }
        return res;
    }
    function click1() {
        //获取表单内容，转换为LIST并且将格式转换，发送GET
        actor1 = $('#actor1').val();
        actor2 = $('#actor2').val();
        event = $('#event').val();
        startdate = $('#start').val();
        enddate = $('#end').val();
        actor1 = split2list(actor1);
        actor2 = split2list(actor2);
        event = list2int(split2list(event));
        startdate = date_split(startdate);
        enddate = date_split(enddate);
        console.log(actor1);
        console.log(actor2);
        console.log(event);
        console.log(startdate);
        console.log(enddate);
        $.get('api/event', { 'actor1': actor1, 'actor2': actor2, 'code': event, 'start': startdate, 'end': enddate }, function (data) {
            console.log(data);
            draw_chart(data);
        });
    }
    function draw_chart(data) {
        //绘制热度和情感值曲线
        var chart = null;
        var color_sentiment = "#D32361";
        var color_heat = "#1D6DBE";
        var color_zeroLine = "#DC143C";
        var item_distance = 200;
        var chart = null;
        chart = Highcharts.chart('container', {
            chart: {
                zoomType: 'x'
            },
            title: {
                text: '事件类型统计曲线'
            },
            xAxis: {
                type: 'datetime',
                dateTimeLabelFormats: {
                    millisecond: '%H:%M:%S.%L',
                    second: '%H:%M:%S',
                    minute: '%H:%M',
                    hour: '%H:%M',
                    day: '%m-%d',
                    week: '%m-%d',
                    month: '%Y-%m',
                    year: '%Y'
                }
            },
            tooltip: {
                dateTimeLabelFormats: {
                    millisecond: '%H:%M:%S.%L',
                    second: '%H:%M:%S',
                    minute: '%H:%M',
                    hour: '%H:%M',
                    day: '%Y-%m-%d',
                    week: '%m-%d',
                    month: '%Y-%m',
                    year: '%Y'
                }
            },
            yAxis: [
                {// 口头合作
                    gridLineWidth: 0,//去掉 Y 轴的参照横线
                    startOnTick: false,//曲线起始允许不在刻度线上
                    endOnTick: false,//曲线终止允许不在刻度线上
                    plotLines: [
                        {     //作零刻度线
                            color: '#d3f261',        //线的颜色，定义为红色
                            dashStyle: 'solid',     //默认值，这里定义为实线
                            value: 0,               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                            width: 2,               //标示线的宽度，5px
                            zIndex: 3
                        }
                    ],
                    title: { // y 轴的title
                        text: ''
                    },
                    labels: {  //刻度线字符的颜色
                        style: {
                            color: '#eb2f96'
                        }
                    }
                },
                {// 实际合作
                    gridLineWidth: 0,//去掉 Y 轴的参照横线
                    startOnTick: false,//曲线起始允许不在刻度线上
                    endOnTick: false,//曲线终止允许不在刻度线上
                    plotLines: [
                        {     //作零刻度线
                            color: '#73d13d',        //线的颜色，定义为红色
                            dashStyle: 'solid',     //默认值，这里定义为实线
                            value: 0,               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                            width: 2,               //标示线的宽度，5px
                            zIndex: 3
                        }
                    ],
                    title: { // y 轴的title
                        text: ''
                    },
                    labels: {  //刻度线字符的颜色
                        style: {
                            color: '#73d13d'
                        }
                    }
                },
                {//口头冲突
                    startOnTick: false,//曲线起始允许不在刻度线上
                    endOnTick: false,//曲线终止允许不在刻度线上
                    opposite: true,  //该曲线参考轴在右侧
                    title: { // y 轴的title
                        text: ''
                    },
                    labels: {  //刻度线字符的颜色
                        style: {
                            color: '#ffa940'
                        }
                    }
                },
                {//实际冲突
                    startOnTick: false,//曲线起始允许不在刻度线上
                    endOnTick: false,//曲线终止允许不在刻度线上
                    opposite: true,  //该曲线参考轴在右侧
                    title: { // y 轴的title
                        text: ''
                    },
                    labels: {  //刻度线字符的颜色
                        style: {
                            color: '#9254de'
                        }
                    }
                }
            ],
            legend: {
                enabled: true
            },
            plotOptions: {
                area: {
                    fillColor: {
                        linearGradient: {
                            x1: 0,
                            y1: 0,
                            x2: 0,
                            y2: 1
                        },
                        stops: [
                            [0, Highcharts.getOptions().colors[0]],
                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                        ]
                    },
                    marker: {
                        radius: 2
                    },
                    lineWidth: 1,
                    states: {
                        hover: {
                            lineWidth: 1
                        }
                    },
                    threshold: null
                }
            },
            series: [{
                type: 'spline',
                name: '口头合作',
                data: data['口头合作']["hot"],
                yAxis: 0,
                selected: true
            },
            {
                type: 'spline',
                name: '实际合作',
                data: data['实际合作']["hot"],
                yAxis: 0,
                selected: true
            },
            {
                type: 'spline',
                name: '口头冲突',
                data: data['口头冲突']["hot"],
                yAxis: 0,
                selected: true
            },
            {
                type: 'spline',
                name: '实际冲突',
                data: data['实际冲突']["hot"],
                yAxis: 0,
                selected: true
            },
            ]
        });
    }
    //draw_chart(data2);
</script>